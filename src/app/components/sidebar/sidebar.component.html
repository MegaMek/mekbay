<!-- Single canonical content template, reused in different wrappers -->
<ng-template #sidebarContent>
    <div class="sidebar-inner"
        [class.tiny]="!layout.isMenuOpen() && !isPhone()">
        <div class="header">
            <div class="brand" (click)="!isPhone() && toggleMenuOpenClose()" aria-label="Mekbay">
            @if (!isPhone() && !layout.isMenuOpen()) {
                <img class="logo" src="/icons/icon-192x192.png" alt="Mekbay">
            } @else {
                <img class="logo" src="/images/logo.png" alt="Mekbay">
            }
            </div>
            <div [cdkPortalOutlet]="unitSearchPortal()"></div>
        </div>

        <force-builder-viewer #forceBuilderViewer [miniMode]="!this.isPhone() && !this.layout.isMenuOpen()"></force-builder-viewer>

        <div class="spanner"></div>

        <div class="footer">
            <sidebar-footer [singleButton]="!this.isPhone() && !this.layout.isMenuOpen()"></sidebar-footer>
        </div>
        <button #burgerLipBtn class="burger-lip-btn" (click)="onLipButtonClick()" 
            (pointerdown)="onLipPointerDown($event)" aria-label="Toggle sidebar">
            <span class="burger-icon">{{ layout.isMenuOpen() ? '«' : '»' }}</span>
        </button>
    </div>
</ng-template>


<!-- overlay backdrop -->
@if (!isDesktop()) {
    <div class="backdrop"
        (pointerdown)="onBackdropPointerDown()" [style.opacity]="backdropOpacity()"
        [class.visible]="(layout.isMenuOpen() || layout.isMenuDragging() || layout.menuOpenRatio() > 0)">
    </div>
}
<!-- PHONE: off-canvas overlay (draggable) -->
@if (isPhone()) {
    <!-- edge area to start drag (10% width) -->
    <div class="touch-edge" (pointerdown)="onPhoneEdgePointerDown($event)" [attr.aria-hidden]="true"></div>
    <!-- off-canvas container -->
    <div class="phone-drawer" role="navigation" (pointerdown)="onPhoneDrawerPointerDown($event)"
        [style.width.px]="phoneWidthPx()" [style.transform]="phoneTransform()"
        [class.open]="drawerOpenState()" [class.dragging]="layout.isMenuDragging()">
        <ng-container [ngTemplateOutlet]="sidebarContent"></ng-container>
    </div>

}

<!-- TABLET: docked collapsed + optional overlay expansion -->
@if (isTablet()) {
    @if (!layout.isMenuOpen()) {
        <!-- tablet docked collapsed -->
        <aside class="docked docked-collapsed" role="navigation" [style.width.px]="this.COLLAPSED_WIDTH">
            <ng-container [ngTemplateOutlet]="sidebarContent"></ng-container>
        </aside>
    } @else {
        <!-- tablet overlay when expanded -->
        <div class="tablet-overlay-panel" (pointerdown)="$event.stopPropagation()"
            [style.width.px]="desktopDockWidth()">
            <ng-container [ngTemplateOutlet]="sidebarContent"></ng-container>
        </div>
    }
}

<!-- DESKTOP: docked (pushes content). Single dock element that changes width -->
@if (isDesktop()) {
    <aside class="docked" role="navigation" [style.width.px]="desktopDockWidth()">
        <ng-container [ngTemplateOutlet]="sidebarContent"></ng-container>
    </aside>
}