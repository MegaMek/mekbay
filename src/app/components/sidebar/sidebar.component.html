<!-- Single canonical content template, reused in different wrappers -->
<ng-template #sidebarContent>
    <div class="sidebar-inner"
        [class.tiny]="tinyMode()">
        <div class="header">
            <div class="brand" (click)="toggleMenuOpenClose()" aria-label="Mekbay">
            @if (tinyMode()) {
                <img class="logo" src="/icons/icon-192x192.png" alt="Mekbay">
            } @else {
                <img class="logo" src="/images/logo.png" alt="Mekbay">
            }
            </div>
            <div class="searchPortal" [cdkPortalOutlet]="unitSearchPortal()"></div>
        </div>

        <force-builder-viewer #forceBuilderViewer [miniMode]="tinyMode()"></force-builder-viewer>

        <div class="footer">
            <sidebar-footer #footer [singleButton]="tinyMode()"></sidebar-footer>
        </div>
        <button #burgerLipBtn class="burger-lip-btn" (click)="onLipButtonClick()" 
            (pointerdown)="onLipPointerDown($event)" aria-label="Toggle sidebar">
            <span class="burger-icon">{{ layout.isMenuOpen() ? '«' : '»' }}</span>
        </button>
    </div>
</ng-template>


<!-- overlay backdrop -->
@if (!isDesktop()) {
    <div class="backdrop"
        (pointerdown)="onBackdropPointerDown()" [style.opacity]="backdropOpacity()"
        [class.visible]="(layout.isMenuOpen() || layout.isMenuDragging() || layout.menuOpenRatio() > 0)">
    </div>
    <div class="touch-edge" (pointerdown)="onEdgePointerDown($event)" [attr.aria-hidden]="true"></div>
}

<div class="drawer glass" role="navigation" (pointerdown)="onDrawerPointerDown($event)"
    [class.desktop]="isDesktop()"
    [class.phone]="isPhone()"
    [class.tablet]="isTablet()"
    [class.glass]="!isDesktop()"
    [style.transform]="drawerTransform()"
    [class.open]="drawerOpenState()" [class.dragging]="layout.isMenuDragging()">
    <ng-container [ngTemplateOutlet]="sidebarContent"></ng-container>
</div>