<ng-template #sidebarContent>
    <div class="sidebar-inner"
        [class.tiny]="tinyMode()">
        <div class="header">
            <div class="brand" (click)="toggleMenuOpenClose()" aria-label="MekBay">
            @if (tinyMode()) {
                <img class="logo" src="/icons/icon-192x192.png" alt="MekBay">
            } @else {
                <img class="logo" src="/images/logo.png" alt="MekBay">
                @if (isNextBuild) { <span class="next-badge" (click)="showNextDialog(); $event.stopPropagation()">NEXT</span> }
            }
            </div>
            <div class="searchPortal" [cdkPortalOutlet]="unitSearchPortal()"></div>
        </div>

        <force-builder-viewer #forceBuilderViewer [miniMode]="tinyMode()"></force-builder-viewer>

        <div class="footer">
            <sidebar-footer #footer [singleButton]="tinyMode()"></sidebar-footer>
        </div>
        <button #burgerLipBtn class="burger-lip-btn glass" (click)="onLipButtonClick()" 
            (pointerdown)="onLipPointerDown($event)" aria-label="Toggle sidebar"
            [style.--top]="lipButtonTop()"
            [style.bottom]="lipButtonTop() ? 'auto' : null">
            <span class="burger-icon">{{ layout.isMenuOpen() ? '«' : '»' }}</span>
        </button>
    </div>
</ng-template>

@if (!isDesktop()) {
    <!-- overlay backdrop -->
    <div class="backdrop"
        (pointerdown)="onBackdropPointerDown()" [style.opacity]="backdropOpacity()"
        [class.visible]="(layout.isMenuOpen() || layout.isMenuDragging() || layout.menuOpenRatio() > 0)">
    </div>
    <!-- touch edge to open drawer -->
    <div class="touch-edge" (pointerdown)="onEdgePointerDown($event)" [attr.aria-hidden]="true"></div>
}

<div class="drawer glass" role="navigation"
    [class.desktop]="isDesktop()"
    [class.phone]="isPhone()"
    [class.tablet]="isTablet()"
    [class.glass]="!isDesktop()"
    [style.transform]="drawerTransform()"
    [class.open]="drawerOpenState()"
    swipe
    [direction]="'horizontal'"
    [shouldBlockSwipe]="shouldBlockSwipe"
    [dragDimensions]="getDragDimension"
    (swipestart)="onSwipeStart($event)"
    (swiperatio)="onSwipeRatio($event)"
    (swipeend)="onSwipeEnd($event)"
    (swipecancel)="onSwipeCancel()"
    >
    <ng-container [ngTemplateOutlet]="sidebarContent"></ng-container>
</div>