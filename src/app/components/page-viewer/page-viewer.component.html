<div #container 
     class="page-viewer-container" 
     [class.at-min-zoom]="isFullyVisible()">
    
    <!-- Swipe wrapper handles X translation during swipe (separate from zoom) -->
    <div #swipeWrapper class="swipe-wrapper">
        <!-- Content wrapper receives zoom/pan transforms, contains all pages -->
        <div #content class="page-content">
            <!-- Pages are rendered here by the component (including off-screen neighbors) -->
            
            <!-- Canvas overlays for each displayed page -->
            @if (!readOnly()) {
                @for (unit of displayedUnitsSignal(); let i = $index; track unit.id) {
                    <page-canvas-overlay 
                        class="page-canvas-overlay-wrapper"
                        [unit]="unit"
                        [width]="612"
                        [height]="792"
                        [style.left.px]="getPagePosition(i)"
                        [style.top.px]="0">
                    </page-canvas-overlay>
                }
            }
        </div>
    </div>
</div>

<!-- Canvas controls (FAB) - global for all canvases -->
@if (!readOnly()) {
    <page-viewer-canvas-controls (clearRequested)="onCanvasClearRequested()"></page-viewer-canvas-controls>
}

<!-- Heat diff markers for each interaction service -->
@if (!readOnly()) {
    @for (marker of heatDiffMarkerArray(); track marker.index) {
        <heat-diff-marker 
            [data]="marker.data"
            [visible]="marker.visible">
        </heat-diff-marker>
    }
}

<!-- Error state -->
@if (loadError()) {
    <div class="error-container">
        <div class="error-message">{{ loadError() }}</div>
        <button (click)="retryLoad()" class="bt-button reload-button">
            <span class="icon">&#x21bb;</span>
            <span>Reload</span>
        </button>
    </div>
}
