/*
 * MekBay - A BattleTech MegaMek unit management system.
 * Copyright (C) 2025 - present The MegaMek Team
 *
 * This program is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by the Free
 * Software Foundation; either version 2 of the License, or (at your option)
 * any later version.
 *
 * This program is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
 * for more details.
 */

:host {
  display: flex;
  flex-direction: column;
  overflow: hidden;
  padding: 0;
  background: var(--background-color);
}

.c3-dialog-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  background-color: var(--background-color-menu);
  border-bottom: 1px solid var(--border-color);

  h2 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 500;
    color: var(--text-primary, #fff);
  }
}

.c3-dialog-header-actions {
  display: flex;
  align-items: center;
  gap: 10px;
}

.connections-layer-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 8px;
  line-height: 1;
  min-width: 40px;

  .icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  svg {
    display: block;
  }
}

.c3-dialog-content {
  display: flex;
  flex: 1;
  overflow: hidden;
  position: relative;
}

// ==================== SVG Canvas ====================

.svg-canvas {
  flex: 1;
  cursor: grab;
  touch-action: none;
  background: var(--background-color);

  &:active {
    cursor: grabbing;
  }
}

// ==================== Node Styles ====================

.node-group {
  cursor: move;
  transition: opacity 0.2s;

  &.dragging {

    .node-bg {
      filter: url(#node-drag-shadow);
    }
  }

  &.valid-target {
    .node-bg {
      stroke: var(--bt-yellow) !important;
      filter: url(#node-valid-glow);
    }

    .node-glow {
      stroke: var(--bt-yellow) !important;
      opacity: 0.8;
    }
  }

  &.invalid-target {
    opacity: 0.4;
  }

  &.hovered {
    .node-bg {
      filter: url(#node-hover-glow);
    }
  }

  &.disconnected {
    .node-inner-ring {
      stroke-dasharray: 4, 4;
    }
  }
}

.node-glow {
  fill: none;
  stroke-width: 2;
  opacity: 0.3;
  filter: url(#glow-blur);
}

.node-bg {
  fill: #2a2a2a;
  fill: url(#node-bg-gradient);
  stroke-width: 3;
  transition: filter 0.2s, stroke 0.2s;
}

.node-border-segment {
  fill: none;
  stroke-width: 3;
  stroke-linecap: butt;
  transition: filter 0.2s;
}

.node-inner-ring {
  fill: none;
  stroke: rgba(255, 255, 255, 0.08);
  stroke-width: 1;
}

.node-label {
  color: var(--text-primary);
  line-height: 1.25;
  text-align: center;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  line-clamp: 2;
  -webkit-box-orient: vertical;
  text-shadow: 0px 0px 2px #000, 0px 0px 4px #000a;
  display: flex;
  flex-direction: column;
  align-items: center;

  .unit-model,
  .unit-chassis,
  .unit-alias {
    width: 95%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .unit-model {
    color: var(--text-color-secondary);
    width: 72%;
    font-size: 0.8em;
  }

  .unit-chassis {
    font-size: 0.9em;
    white-space: normal;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    font-weight: 700;
  }

  .unit-alias {
    font-size: 0.9em;
  }
}

.node-icon {
  pointer-events: none;
}

// ==================== Pin Styles ====================

.pin-container {

  .pin {
    cursor: pointer;
    transition: opacity 0.2s;

    .pin-ring {
      fill: none;
      stroke-width: 1.5;
      opacity: 0.4;
      transition: opacity 0.2s, transform 0.15s;
    }

    .pin-connector {
      stroke-width: 2.5;
      transition: transform 0.15s ease-out, filter 0.2s;
    }


    &:hover {
      .pin-connector {
        transform: scale(1.2);
      }

      .pin-ring {
        opacity: 0.7;
        transform: scale(1.1);
      }
    }
  }

  .pin-role-label {
    font-size: 12px;
    font-weight: 700;
    fill: var(--text-primary, #fff);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .pin-type-label {
    font-size: 10px;
    font-weight: 500;
    fill: var(--text-color-secondary, #666);
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }

  &.master,
  &.slave,
  &.peer {
    .pin-role-label {
      fill: var(--text-color);
    }
  }

  // Connected pin
  &.connected {
    .pin-ring {
      opacity: 0.6;
    }
  }

  // Valid target pin during drag
  &.valid-pin-target {
    .pin-connector {
      stroke: var(--bt-yellow) !important;
      filter: url(#pin-valid-glow);
    }

    .pin-ring {
      stroke: var(--bt-yellow) !important;
      opacity: 0.8;
    }
  }

  // Invalid target pin during drag
  &.invalid-pin-target:not(.connectingFromPin) {
    opacity: 0.25;
  }

  // Hovered pin during drag
  .pin {
    &.hovered-pin {
      .pin-connector {
        transform: scale(1.4);
        filter: url(#pin-hover-glow);
      }

      .pin-ring {
        transform: scale(1.2);
        opacity: 1;
      }
    }

    &.disabled {
      cursor: not-allowed;

      &:hover {
        .pin-connector {
          transform: none;
        }

        .pin-ring {
          transform: none;
          opacity: 0.4;
        }
      }
    }
  }

  // Source pin (being dragged from)
  &.connectingFromPin {
    .pin-connector {
      transform: scale(1.25);
      filter: url(#pin-active-glow);
    }

    .pin-ring {
      opacity: 0.8;
    }
  }

  // Disabled pin (mutual exclusion)
  &.disabled {
    opacity: 0.35;

    .pin-role-label,
    .pin-type-label {
      fill: #555;
    }
  }
}

// ==================== Connection Lines ====================

.connections-layer {
  pointer-events: none;

  line {
    stroke-linecap: round;
  }
}

// ==================== Sidebar ====================

.networks-sidebar {
  width: 300px;
  display: flex;
  flex-direction: column;
  background-color: var(--background-color-menu);
  overflow: hidden;

  &.overlay {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 100%;
    max-width: 300px;
    box-shadow: -2px 0 8px rgba(0, 0, 0, 0.5);
    z-index: 200;
  }

  &.animate {
    transition: transform 0.2s ease-in-out;
  }

  &.hidden {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    transform: translateX(100%);
    z-index: 100;
  }

  h3 {
    margin: 0;
    padding: 12px 16px;
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-primary, #fff);
    border-bottom: 1px solid var(--border-color, #444);
  }
}

.networks-list {
  flex: 1;
  overflow-y: auto;
  padding: 8px;
}

.network-item {
  background: var(--network-item-bg, #2a2a2a);
  border: 1px solid var(--network-color, var(--border-color, #444));
  border-left: 4px solid var(--network-color, var(--border-color, #444));
  padding: 8px;
  margin-bottom: 8px;

  &.sub-network {
    position: relative;
    background: rgba(0, 0, 0, 0.2);
    margin-top: 0px;
    margin-bottom: 4px;
    padding: 6px 8px;

    .network-header {
      margin-bottom: 6px;
    }

    .network-type {
      font-size: 0.7rem;
    }
  }
}

.subnetwork-arrow {
  position: absolute;
  top: -14px;
  left: 8px;
  color: var(--network-color);
}

.network-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;

  .network-type {
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--text-primary, #fff);
    flex: 1;
  }
}

.network-units {
  display: flex;
  flex-direction: column;
  gap: 4px;

  .network-unit-item {
    display: flex;
    flex-direction: column;
    gap: 4px;

    .row {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      gap: 4px;
    }
  }

  .network-unit {
    font-size: 0.7rem;
    color: var(--text-secondary, #aaa);
    background: var(--tag-bg, #333);
    padding: 3px 8px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;

    &.master {
      color: var(--text-primary, #fff);
      font-weight: 500;
    }

    .role-badge {
      font-size: 0.6rem;
      opacity: 0.7;
      margin-left: 4px;
    }
  }
}



.remove-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  background: none;
  border: none;
  color: #999;
  font-size: 0.7rem;
  cursor: pointer;
  transition: color 0.2s;
  flex-shrink: 0;
  width: 12px;

  svg {
    width: 12px;
    height: 12px;
  }

  &:hover {
    color: red;
  }
}

.no-networks {
  text-align: center;
  color: var(--text-secondary, #888);
  font-size: 0.8rem;
  padding: 20px;
  line-height: 1.6;
}

.clear-all-btn {
  margin: 8px;
}

.c3-dialog-footer {
  display: flex;
  justify-content: space-around;
  gap: 12px;
  padding: 16px 20px;
  background-color: var(--background-color-menu);
  border-top: 1px solid var(--border-color);
}