<div class="alpha-strike-viewer" 
     #viewerContainer
     [class.monochrome]="cardStyle() === 'monochrome'"
     (pointerdown)="onPointerDown($event)"
     (pointermove)="onPointerMove($event)"
     (pointerup)="onPointerUp($event)"
     (pointercancel)="onPointerCancel($event)"
     (pointerleave)="onPointerUp($event)">
    <div class="section-content">
        <div class="flex-grid">
            @let groups = force()?.groups();
            @if (!groups || groups.length === 0) {
                <div class="no-units-message">
                    No units in this force.
                </div>
            } @else {
                @for (group of groups; track group.id) {
                    @if (groups.length > 1) {
                    <div class="group-header">
                        {{ group.name() }}
                    </div>
                    }
                    @for (forceUnit of group.units(); track forceUnit.id) {
                    <div class="as-unit-card" #cardWrapper 
                         [attr.data-unit-id]="forceUnit.id"
                         [style.width.px]="cardWidth()">
                        <alpha-strike-card [forceUnit]="forceUnit" [useHex]="useHex()" [cardStyle]="cardStyle()" [isSelected]="unit()?.id === forceUnit.id" (selected)="onUnitSelected($event)" />
                    </div>
                    }
                    @if (groups.length > 1) {
                    <hr class="group-separator" />
                    }
                }
            }
        </div>
    </div>

    <!-- Toggle Buttons -->
    <div class="toggle-buttons screen-only">
        <!-- Hex/Inches Toggle -->
        <button class="toggle-btn" [class.active]="useHex()" (click)="toggleHexMode()" title="Toggle Hex/Inches">
            @if (useHex()) {
            <!-- Hex icon -->
            <svg fill="currentColor" width="24px" height="24px" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M30.8508,15.4487,23.8867,3.5322A1.0687,1.0687,0,0,0,22.9643,3H9.0357a1.0687,1.0687,0,0,0-.9224.5322L1.1492,15.4487a1.0933,1.0933,0,0,0,0,1.1026L8.1133,28.4678A1.0687,1.0687,0,0,0,9.0357,29H22.9643a1.0687,1.0687,0,0,0,.9224-.5322l6.9641-11.9165A1.0933,1.0933,0,0,0,30.8508,15.4487Z" />
            </svg>
            } @else {
            <!-- Tape measure icon -->
            <svg fill="currentColor" width="24px" height="24px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M20 3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H4V5h16v14zM6 7h2v2H6V7zm0 4h2v2H6v-2zm0 4h2v2H6v-2zm4-8h2v2h-2V7zm0 4h2v2h-2v-2zm4-4h2v2h-2V7z" />
            </svg>
            }
        </button>

        <!-- Color/Monochrome Toggle -->
        <button class="toggle-btn" [class.active]="cardStyle() === 'colored'" (click)="toggleCardStyle()"
            title="Toggle Color/Monochrome">
            @if (cardStyle() === 'colored') {
            <!-- Color palette icon -->
            <svg fill="currentColor" width="24px" height="24px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10c1.38 0 2.5-1.12 2.5-2.5 0-.61-.23-1.2-.64-1.67-.08-.1-.13-.21-.13-.33 0-.28.22-.5.5-.5H16c3.31 0 6-2.69 6-6 0-4.96-4.49-9-10-9zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 8 6.5 8 8 8.67 8 9.5 7.33 11 6.5 11zm3-4C8.67 7 8 6.33 8 5.5S8.67 4 9.5 4s1.5.67 1.5 1.5S10.33 7 9.5 7zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 4 14.5 4s1.5.67 1.5 1.5S15.33 7 14.5 7zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 8 17.5 8s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z" />
            </svg>
            } @else {
            <!-- Monochrome icon -->
            <svg fill="currentColor" width="24px" height="24px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10 10-4.49 10-10S17.51 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5-9c.83 0 1.5-.67 1.5-1.5S7.83 8 7 8s-1.5.67-1.5 1.5S6.17 11 7 11zm3-4c.83 0 1.5-.67 1.5-1.5S10.83 4 10 4s-1.5.67-1.5 1.5S9.17 7 10 7zm4 0c.83 0 1.5-.67 1.5-1.5S14.83 4 14 4s-1.5.67-1.5 1.5S13.17 7 14 7zm3 4c.83 0 1.5-.67 1.5-1.5S17.83 8 17 8s-1.5.67-1.5 1.5.67 1.5 1.5 1.5z" />
            </svg>
            }
        </button>
    </div>
</div>