<div class="tag-selector-container framed-borders has-shadow">
    <!-- Unit-specific tags section -->
    <div class="tag-section">
        <button 
            type="button"
            class="tag-option tag-option-new"
            (click)="onAddNewNameTag()">
            <span class="tag-icon">+</span>
            <span class="tag-label">Add new tag to unit...</span>
        </button>
        <div class="tag-list">
            @for (tag of nameTags(); track $index) {
                <div 
                    class="tag-option"
                    [class.tag-assigned]="isNameTagFullyAssigned(tag)"
                    [class.tag-partial]="isNameTagPartiallyAssigned(tag)"
                    [class.tag-covered]="isNameTagCoveredByChassis(tag)"
                    (click)="onNameTagClick(tag)">
                    <span class="tag-label">{{ tag }}</span>
                    @if (isNameTagAssignedToAny(tag)) {
                        <button
                            type="button"
                            class="tag-action-btn tag-remove-btn"
                            (click)="onRemoveNameTag(tag, $event)"
                            title="Remove tag"
                            aria-label="Remove tag">
                            <svg fill="currentColor" width="24px" height="24px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21.842 6.218a1.977 1.977 0 0 0-.424-.628A1.99 1.99 0 0 0 20 5H8c-.297 0-.578.132-.769.359l-5 6c-.309.371-.309.91 0 1.281l5 6c.191.228.472.36.769.36h12a1.977 1.977 0 0 0 1.41-.582A1.99 1.99 0 0 0 22 17V7c0-.266-.052-.525-.158-.782zm-4.135 8.075-1.414 1.414L14 13.414l-2.293 2.293-1.414-1.414L12.586 12l-2.293-2.293 1.414-1.414L14 10.586l2.293-2.293 1.414 1.414L15.414 12l2.293 2.293z"/></svg>
                        </button>
                    }
                </div>
            }
            @if (nameTags().length === 0) {
                <div class="tag-option-empty">No existing tags</div>
            }
        </div>
    </div>

    <!-- Chassis-wide tags section -->
    <hr class="divider" />
    <div class="tag-section">
        <button 
            type="button"
            class="tag-option tag-option-new tag-option-chassis"
            (click)="onAddNewChassisTag()">
            <span class="tag-icon">+</span>
            <span class="tag-label">Add new tag to all variants...</span>
        </button>
        <div class="tag-list">
            @for (tag of chassisTags(); track $index) {
                <div 
                    class="tag-option tag-option-chassis-item"
                    [class.tag-assigned]="isChassisTagFullyAssigned(tag)"
                    [class.tag-partial]="isChassisTagPartiallyAssigned(tag)"
                    (click)="onChassisTagClick(tag)">
                    <span class="tag-label">{{ tag }}</span>
                    @if (isChassisTagAssignedToAny(tag)) {
                        <button
                            type="button"
                            class="tag-action-btn tag-remove-btn"
                            (click)="onRemoveChassisTag(tag, $event)"
                            title="Remove tag"
                            aria-label="Remove tag">
                            <svg fill="currentColor" width="24px" height="24px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21.842 6.218a1.977 1.977 0 0 0-.424-.628A1.99 1.99 0 0 0 20 5H8c-.297 0-.578.132-.769.359l-5 6c-.309.371-.309.91 0 1.281l5 6c.191.228.472.36.769.36h12a1.977 1.977 0 0 0 1.41-.582A1.99 1.99 0 0 0 22 17V7c0-.266-.052-.525-.158-.782zm-4.135 8.075-1.414 1.414L14 13.414l-2.293 2.293-1.414-1.414L12.586 12l-2.293-2.293 1.414-1.414L14 10.586l2.293-2.293 1.414 1.414L15.414 12l2.293 2.293z"/></svg>
                        </button>
                    }
                </div>
            }
            @if (chassisTags().length === 0) {
                <div class="tag-option-empty">No existing tags</div>
            }
        </div>
    </div>

    <!-- Public tags section (read-only) -->
    @if (publicTags().length > 0) {
        <hr class="divider" />
        <div class="tag-section tag-section-public">
            <div class="tag-section-header">Public tags (read-only)</div>
            <div class="tag-list">
                @for (pt of publicTags(); track pt.publicId + ':' + pt.tag) {
                    <div 
                        class="tag-option tag-option-public"
                        [class.subscribed]="pt.subscribed"
                        [title]="'From: ' + pt.publicId">
                        <span class="tag-label">{{ pt.tag }}</span>
                        @if (pt.subscribed) {
                            <span class="tag-subscribed-icon" title="Subscribed">‚ü≥</span>
                            <button
                                type="button"
                                class="tag-action-btn tag-remove-btn"
                                (click)="onUnsubscribe(pt, $event)"
                                title="Unsubscribe from this tag"
                                aria-label="Unsubscribe">
                                <svg fill="currentColor" width="24px" height="24px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21.842 6.218a1.977 1.977 0 0 0-.424-.628A1.99 1.99 0 0 0 20 5H8c-.297 0-.578.132-.769.359l-5 6c-.309.371-.309.91 0 1.281l5 6c.191.228.472.36.769.36h12a1.977 1.977 0 0 0 1.41-.582A1.99 1.99 0 0 0 22 17V7c0-.266-.052-.525-.158-.782zm-4.135 8.075-1.414 1.414L14 13.414l-2.293 2.293-1.414-1.414L12.586 12l-2.293-2.293 1.414-1.414L14 10.586l2.293-2.293 1.414 1.414L15.414 12l2.293 2.293z"/></svg>
                            </button>
                        }
                    </div>
                }
            </div>
        </div>
    }
</div>