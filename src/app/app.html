<main class="app-container" [class.menu-open]="this.layoutService.isMenuOpen()">
    @if (this.hasUnits()) {
    <sidebar #sidebar [unitSearchPortal]="unitSearchPortalForceBuilder()"
        [unitSearchComponent]="unitSearchComponentRef()"></sidebar>
    }
    <div class="extended-search-container">
        <div [cdkPortalOutlet]="unitSearchPortalExtended"></div>
    </div>
    <div class="main-content">

        @if (this.hasUnits()) {
        <div class="content-area">
            @if (gameService.isAlphaStrike()) {
            <alpha-strike-viewer [unit]="selectedASUnit()" [force]="currentASForce()"></alpha-strike-viewer>
            } @else {
            <page-viewer [unit]="selectedCBTUnit()" [force]="currentCBTForce()"></page-viewer>
            }
        </div>
        } @else {
        <!-- Empty state -->
        <div class="empty-state-container">
            <div class="header">
                <div class="home-buttons noprint">
                    <button class="home-button" (click)="showLoadForceDialog()">
                        <svg fill="currentColor" width="32px" height="32px" viewBox="0 0 1920 1920"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="m572.501 747-254.933 815.893-101.867-31.786 278.507-890.774h1105.813v-320H783.808L612.181 107H.021v1546.667c0 88.213 71.787 160 160 160h1388.054c75.946 0 141.973-54.08 156.906-128.64L1892.608 747H572.501Z"
                                fill-rule="evenodd" />
                        </svg>
                    </button>
                    <button class="home-button" (click)="showOptionsDialog()">
                        <svg fill="currentColor" width="32px" height="32px" viewBox="0 0 1920 1920"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M1703.534 960c0-41.788-3.84-84.48-11.633-127.172l210.184-182.174-199.454-340.856-265.186 88.433c-66.974-55.567-143.323-99.389-223.85-128.415L1158.932 0h-397.78L706.49 269.704c-81.43 29.138-156.423 72.282-223.962 128.414l-265.073-88.32L18 650.654l210.184 182.174C220.39 875.52 216.55 918.212 216.55 960s3.84 84.48 11.633 127.172L18 1269.346l199.454 340.856 265.186-88.433c66.974 55.567 143.322 99.389 223.85 128.415L761.152 1920h397.779l54.663-269.704c81.318-29.138 156.424-72.282 223.963-128.414l265.073 88.433 199.454-340.856-210.184-182.174c7.793-42.805 11.633-85.497 11.633-127.285m-743.492 395.294c-217.976 0-395.294-177.318-395.294-395.294 0-217.976 177.318-395.294 395.294-395.294 217.977 0 395.294 177.318 395.294 395.294 0 217.976-177.317 395.294-395.294 395.294"
                                fill-rule="evenodd" />
                        </svg>
                    </button>
                </div>
                <div class="main-search">
                    <div class="empty-state-logo">
                        <img src="/images/logo.png" alt="MekBay Logo">
                        <div class="beta-notice noprint" (click)="showBetaDialog();">BETA</div>
                    </div>
                    <div class="search-container">
                        <div [cdkPortalOutlet]="unitSearchPortalMain"></div>
                    </div>
                    @if (this.dataService.isDownloading() || this.dataService.isCloudForceLoading()) {
                    <div class="spinner-container">
                        <div class="spinner">
                            <div class="ring"></div>
                        </div>
                        <div>
                            Downloading data...
                        </div>
                    </div>
                    }
                </div>
                <div class="gameSystemSelector" [class.loading]="!this.dataService.isDataReady()">
                    <div class="battletech-logo" [class.inactive]="gameService.isAlphaStrike()" (click)="this.dataService.isDataReady() && gameService.setOverride(GameSystem.CBT)">
                            <svg fill="#fff" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 790 100">
                                <g>
                                    <path class="logo-text"
                                        d="m 613.14797,97.475074 c -22.55326,-4.54102 -37.15014,-23.093463 -35.59872,-45.245504 0.80541,-11.500123 4.65183,-20.129404 12.33332,-27.669285 8.70005,-8.53966 19.66012,-12.841085 32.94182,-12.928434 13.03574,-0.08571 22.06992,3.344107 29.95796,11.373609 4.30902,4.386291 9.64083,12.354358 8.81769,13.177502 -0.48955,0.489545 -18.75978,9.049511 -20.47631,9.59357 -1.28765,0.408111 -1.96543,-0.151872 -3.84663,-3.178085 -1.45635,-2.342783 -3.5741,-4.429788 -5.84618,-5.761307 -9.13401,-5.352899 -22.62013,-0.192407 -26.08697,9.982218 -1.87994,5.517331 -1.54632,13.334811 0.76721,17.977475 4.14483,8.317581 13.22817,12.313718 22.27788,9.800981 3.11377,-0.864571 10.18475,-7.253029 10.18475,-9.201671 0,-0.612272 0.31314,-1.306735 0.69586,-1.543272 0.55987,-0.346024 21.30969,8.637335 22.34734,9.674984 0.15811,0.158104 -0.66682,2.076919 -1.83316,4.264015 -2.70077,5.064342 -10.72234,13.110593 -15.73262,15.781022 -8.54657,4.555229 -20.29316,6.038485 -30.90324,3.902182 z M 1.432377,54.886471 l 0,-42.291291 26.734517,0.0117 c 28.953298,0.01266 32.397458,0.368487 38.567864,3.984585 13.631143,7.988382 13.737063,28.930366 0.181219,35.829155 -2.190529,1.114789 -2.191238,1.117415 -0.451992,1.669431 2.916553,0.92567 8.378881,6.520629 10.230164,10.478542 2.158699,4.615149 2.382168,12.500468 0.509976,17.995039 -1.645329,4.828763 -7.551683,10.785957 -12.587425,12.69577 -3.388228,1.284982 -6.476365,1.438839 -33.45854,1.667006 l -29.725783,0.251359 0,-42.291282 z m 48.096499,19.665707 c 0.898395,-0.472873 1.880668,-1.230047 2.182849,-1.682594 C 52.668353,71.4369 52.329337,68.475488 51.046407,67.057876 49.949844,65.846179 48.500843,65.6903 38.333494,65.6903 l -11.475292,0 0,4.860823 0,4.860823 10.518626,0 c 6.479807,0 11.145807,-0.330129 12.152048,-0.859768 z M 49.420837,42.018111 c 1.678338,-1.518873 1.768324,-4.237325 0.192417,-5.813223 -0.959715,-0.959724 -3.153138,-1.17515 -11.965096,-1.17515 l -10.789956,0 0,4.113006 0,4.112997 10.597539,0 c 8.81168,0 10.827988,-0.208552 11.965096,-1.23763 z m 127.001083,24.439995 0,-30.640563 -11.03033,-0.20695 -11.03032,-0.206942 0,-11.217279 0,-11.217279 35.14748,0 35.14747,0 0,11.217279 0,11.217279 -11.03032,0.206942 -11.03033,0.20695 0,30.640563 0,30.640572 -13.08682,0 -13.08683,0 z m 74.78186,-0.01994 0,-30.660561 -11.23676,0 -11.23675,0 0.20642,-11.404231 0.20644,-11.404241 35.14747,0 35.14748,0 0,11.217279 0,11.21728 -11.03033,0.206941 -11.03033,0.20696 0,30.640563 0,30.640572 -13.08682,0 -13.08682,0 z m 53.27584,-11.404231 0.19319,-42.064802 12.89987,-0.204611 12.89986,-0.204612 0,30.678221 0,30.678222 15.70419,0 15.70419,0 0,11.591182 0,11.591193 -28.79724,0 -28.79723,0 z m 63.70339,41.071024 c -0.20974,-0.54658 -0.28331,-19.475735 -0.16349,-42.064792 l 0.21787,-41.071034 68.61235,-0.190863 68.61235,-0.190873 0,11.595104 0,11.595104 -11.21728,0 -11.21728,0 0,30.660561 0,30.660562 -12.71291,0 -12.71292,0 0,-30.660562 0,-30.660561 -31.78229,0 -31.78228,0 0,3.739093 0,3.739093 18.69546,0 18.69546,0 0,11.217279 0,11.21728 -18.69546,0 -18.69546,0 0,4.112996 0,4.113007 19.06937,0 19.06937,0 0,11.591182 0,11.591193 -31.80576,0 c -25.76175,0 -31.87822,-0.18885 -32.1871,-0.993769 z m 142.51381,-41.257985 0,-42.251745 31.78229,0 31.78229,0 0,11.591183 0,11.591193 -18.69546,0 -18.69547,0 0,3.739093 0,3.739093 18.32155,0 18.32156,0 0,11.217279 0,11.21728 -18.32156,0 -18.32155,0 0,4.112996 0,4.113007 18.69547,0 18.69546,0 0,11.591182 0,11.591193 -31.78229,0 -31.78229,0 z m 154.97917,0.186961 0.19318,-42.064802 12.89988,-0.204611 12.89986,-0.204612 0,14.974032 0,14.974032 14.58246,0 14.58247,0 0,-14.974032 0,-14.974032 12.89986,0.204612 12.89988,0.204611 0,41.877841 0,41.877841 -12.89988,0.204611 -12.89986,0.204621 0,-16.095762 0,-16.095762 -14.58247,0 -14.58246,0 0,16.078103 0,16.078102 -13.09305,0 -13.09304,0 z" />
                                    <path
                                        d="m 81.354266,96.997204 m -1.627755,-27.03083 c 0,-1.33965 39.191139,-70.72527986 39.670909,-70.23501986 0.33538,0.34274 9.36944,16.27127986 20.07565,35.39672986 l 19.46585,34.77357 -13.19042,0.20474 c -7.25473,0.11262 -13.43513,-0.0556 -13.73422,-0.3739 -0.29911,-0.31827 -3.31884,-5.57872 -6.71055,-11.68991 -5.31432,-9.57538 -6.27985,-10.91917 -6.98514,-9.72164 -0.45011,0.76429 -3.34948,5.9326 -6.44302,11.48516 l -5.62462,10.09555 -13.262212,0.20421 c -7.294228,0.11231 -13.262227,0.0496 -13.262227,-0.13949 z"
                                        style="fill: #EAAE3F; fill-opacity: 1;" />
                                    <path
                                        d="m 81.354266,96.997204 c 0.132976,-0.52117 2.748565,-5.40069 5.812408,-10.84338 l 5.570619,-9.89577 26.257817,0 26.25782,0 5.74945,10.15953 c 3.16218,5.58774 5.74943,10.46725 5.74943,10.84337 0,0.40421 -15.46403,0.68383 -37.81966,0.68383 -30.157097,0 -37.770684,-0.19199 -37.577884,-0.94758 z"
                                        style="fill: #EAAE3F; fill-opacity: 1;" />
                                </g>
                                <text class="logo-text" x="750" y="30" text-anchor="start" font-size="25">TM</text>
                            </svg>
                        </div>
                        <div class="game-system-switch" (click)="this.dataService.isDataReady() && gameService.setOverride(gameService.isAlphaStrike() ? GameSystem.CBT : GameSystem.AS)">
                            <div class="switch-track" [class.as-active]="gameService.isAlphaStrike()">
                                <div class="switch-thumb"></div>
                            </div>
                        </div>
                        <div class="as-logo" [class.inactive]="!gameService.isAlphaStrike()" (click)="this.dataService.isDataReady() && gameService.setOverride(GameSystem.AS)">
                            <svg viewBox="0 0 88 14" xmlns="http://www.w3.org/2000/svg">
                                <g>
                                    <path style="fill:none;stroke:#fff200;stroke-width:0.8;stroke-miterlimit:3.226"
                                        d="M 5.15,-10.3 6.68,0 H 3.94 L 3.81,-1.85 H 2.85 L 2.69,0 H -0.076 L 1.28,-10.3 Z m -1.42,6.63 q -0.2,-1.74 -0.4,-4.31 -0.41,2.95 -0.51,4.31 z m 7.37,-6.63 v 8.24 h 1.6 V 0 H 8.43 v -10.3 z m 3.6,0 h 2.7 q 1.1,0 1.6,0.2 0.6,0.17 0.9,0.49 0.3,0.32 0.4,0.79 0.1,0.45 0.1,1.42 v 0.89 q 0,0.99 -0.2,1.44 -0.2,0.45 -0.7,0.69 -0.6,0.24 -1.4,0.24 H 17.4 V 0 h -2.7 z m 2.7,1.78 v 2.62 q 0.1,0 0.1,0 0.4,0 0.6,-0.17 0.1,-0.19 0.1,-0.76 V -7.67 Q 18.2,-8.2 18,-8.36 17.9,-8.52 17.4,-8.52 Z M 28.6,-10.3 V 0 H 26 V -4.32 H 25.2 V 0 h -2.7 v -10.3 h 2.7 v 3.7 H 26 v -3.7 z m 7,0 1.6,10.3 h -2.8 l -0.1,-1.85 h -1 L 33.2,0 h -2.8 l 1.4,-10.3 z m -1.4,6.63 q -0.2,-1.74 -0.4,-4.31 -0.4,2.95 -0.5,4.31 z m 14,-3.5 h -2.5 v -0.76 q 0,-0.53 -0.1,-0.68 -0.1,-0.14 -0.3,-0.14 -0.3,0 -0.4,0.19 -0.1,0.2 -0.1,0.6 0,0.51 0.1,0.77 0.2,0.26 0.8,0.63 1.8,1.06 2.2,1.74 0.5,0.68 0.5,2.19 0,1.1 -0.3,1.62 -0.2,0.521 -1,0.877 -0.7,0.349 -1.7,0.349 -1,0 -1.8,-0.406 -0.8,-0.407 -1,-1.04 -0.2,-0.62 -0.2,-1.78 v -0.67 h 2.5 v 1.25 q 0,0.58 0.1,0.74 0.1,0.17 0.3,0.17 0.3,0 0.4,-0.21 0.2,-0.21 0.2,-0.62 0,-0.91 -0.3,-1.19 -0.2,-0.28 -1.2,-0.94 -1,-0.66 -1.4,-0.95 -0.3,-0.3 -0.5,-0.83 -0.2,-0.53 -0.2,-1.34 0,-1.19 0.3,-1.73 0.3,-0.55 1,-0.87 0.6,-0.3 1.6,-0.3 1,0 1.8,0.3 0.7,0.38 0.9,0.89 0.3,0.51 0.3,1.74 z m 7.7,-3.13 v 2.08 H 54.3 V 0 h -2.6 v -8.22 h -1.6 v -2.08 z m 1.9,0 h 1.9 q 1.9,0 2.6,0.2 0.7,0.12 1.1,0.72 0.4,0.59 0.4,1.91 0,1.2 -0.3,1.61 -0.3,0.41 -1.2,0.5 0.8,0.19 1.1,0.52 0.3,0.33 0.3,0.61 0.1,0.28 0.1,1.52 V 0 h -2.5 v -3.42 q 0,-0.82 -0.1,-1.02 -0.1,-0.19 -0.7,-0.19 V 0 h -2.7 z m 2.7,1.78 v 2.29 q 0.5,0 0.6,-0.12 0.2,-0.13 0.2,-0.81 v -0.57 q 0,-0.48 -0.2,-0.64 -0.1,-0.15 -0.6,-0.15 z m 8.3,-1.78 V 0 h -2.7 v -10.3 z m 8.7,0 L 76,-5.64 77.7,0 H 74.9 L 73.8,-4.41 V 0 h -2.6 v -10.3 h 2.6 v 4.02 L 75,-10.3 Z m 2,0 h 4.4 v 2.08 h -1.8 v 1.95 h 1.7 v 1.95 h -1.7 v 2.26 h 2 V 0 h -4.6 z"
                                        transform="translate(3, 12)" />
                                    <path style="fill:#d22027"
                                        d="M 5.15,-10.3 6.68,0 H 3.94 L 3.81,-1.85 H 2.85 L 2.69,0 H -0.076 L 1.28,-10.3 Z m -1.42,6.63 q -0.2,-1.74 -0.4,-4.31 -0.41,2.95 -0.51,4.31 z m 7.37,-6.63 v 8.24 h 1.6 V 0 H 8.43 v -10.3 z m 3.6,0 h 2.7 q 1.1,0 1.6,0.2 0.6,0.17 0.9,0.49 0.3,0.32 0.4,0.79 0.1,0.45 0.1,1.42 v 0.89 q 0,0.99 -0.2,1.44 -0.2,0.45 -0.7,0.69 -0.6,0.24 -1.4,0.24 H 17.4 V 0 h -2.7 z m 2.7,1.78 v 2.62 q 0.1,0 0.1,0 0.4,0 0.6,-0.17 0.1,-0.19 0.1,-0.76 V -7.67 Q 18.2,-8.2 18,-8.36 17.9,-8.52 17.4,-8.52 Z M 28.6,-10.3 V 0 H 26 V -4.32 H 25.2 V 0 h -2.7 v -10.3 h 2.7 v 3.7 H 26 v -3.7 z m 7,0 1.6,10.3 h -2.8 l -0.1,-1.85 h -1 L 33.2,0 h -2.8 l 1.4,-10.3 z m -1.4,6.63 q -0.2,-1.74 -0.4,-4.31 -0.4,2.95 -0.5,4.31 z m 14,-3.5 h -2.5 v -0.76 q 0,-0.53 -0.1,-0.68 -0.1,-0.14 -0.3,-0.14 -0.3,0 -0.4,0.19 -0.1,0.2 -0.1,0.6 0,0.51 0.1,0.77 0.2,0.26 0.8,0.63 1.8,1.06 2.2,1.74 0.5,0.68 0.5,2.19 0,1.1 -0.3,1.62 -0.2,0.521 -1,0.877 -0.7,0.349 -1.7,0.349 -1,0 -1.8,-0.406 -0.8,-0.407 -1,-1.04 -0.2,-0.62 -0.2,-1.78 v -0.67 h 2.5 v 1.25 q 0,0.58 0.1,0.74 0.1,0.17 0.3,0.17 0.3,0 0.4,-0.21 0.2,-0.21 0.2,-0.62 0,-0.91 -0.3,-1.19 -0.2,-0.28 -1.2,-0.94 -1,-0.66 -1.4,-0.95 -0.3,-0.3 -0.5,-0.83 -0.2,-0.53 -0.2,-1.34 0,-1.19 0.3,-1.73 0.3,-0.55 1,-0.87 0.6,-0.3 1.6,-0.3 1,0 1.8,0.3 0.7,0.38 0.9,0.89 0.3,0.51 0.3,1.74 z m 7.7,-3.13 v 2.08 H 54.3 V 0 h -2.6 v -8.22 h -1.6 v -2.08 z m 1.9,0 h 1.9 q 1.9,0 2.6,0.2 0.7,0.12 1.1,0.72 0.4,0.59 0.4,1.91 0,1.2 -0.3,1.61 -0.3,0.41 -1.2,0.5 0.8,0.19 1.1,0.52 0.3,0.33 0.3,0.61 0.1,0.28 0.1,1.52 V 0 h -2.5 v -3.42 q 0,-0.82 -0.1,-1.02 -0.1,-0.19 -0.7,-0.19 V 0 h -2.7 z m 2.7,1.78 v 2.29 q 0.5,0 0.6,-0.12 0.2,-0.13 0.2,-0.81 v -0.57 q 0,-0.48 -0.2,-0.64 -0.1,-0.15 -0.6,-0.15 z m 8.3,-1.78 V 0 h -2.7 v -10.3 z m 8.7,0 L 76,-5.64 77.7,0 H 74.9 L 73.8,-4.41 V 0 h -2.6 v -10.3 h 2.6 v 4.02 L 75,-10.3 Z m 2,0 h 4.4 v 2.08 h -1.8 v 1.95 h 1.7 v 1.95 h -1.7 v 2.26 h 2 V 0 h -4.6 z"
                                        transform="translate(3, 12)" />
                                </g>
                            </svg>
                        </div>
                    </div>
            </div>

            <div class="footer">
                @if (showInstallButton()) {
                <div class="install-container">
                    <button class="bt-button install-button" (click)="installPwa()">
                        <svg fill="currentColor" width="24px" height="24px" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" />
                        </svg>
                        Install MekBay App
                    </button>
                </div>
                }
                <div class="build-info noprint" (click)="showBetaDialog();">{{ buildInfo }}</div>
                <span class="footer-text" style="cursor:pointer" (click)="showLicenseDialog();">MekBay is an
                    open-source, fan-made project not affiliated with Catalyst Game Labs or The Topps Company, Inc.
                    BattleTech and related marks are trademarks of The Topps Company, Inc. All rights
                    reserved.</span>
            </div>
        </div>
        }
    </div>
    <update-button [updateAvailable]="updateAvailable()"></update-button>
    <app-toasts></app-toasts>
    <div #unitSearchContainer>
        <unit-search></unit-search>
    </div>
</main>